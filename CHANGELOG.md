# Лог на промените

Този файл документира всички значими промени, направени по интеграцията `yt-dlp-downloader`.

## Версия 0.5.0 - Корекции на сензора и Lovelace картата

*   **Корекция на сензора (`sensor.py`)**: Основното състояние (`state`) на сензора вече е **числов процент** (`progress`), за да се реши грешката `Entity is non-numeric` в Lovelace. Името на сензора е променено на `sensor.yt_dlp_downloader_progress`.
*   **Текстовият статус е преместен в атрибут**: Статусът (`Downloading`, `Idle` и т.н.) вече е достъпен като атрибут (`status`) на сензора.
*   **Подобрена Lovelace карта (`README.md`)**: Примерната карта е актуализирана, за да работи с новия числен сензор. Тя вече използва `conditional` карта, за да показва прогреса и детайлите само по време на активно сваляне, което я прави по-изчистена.

## Версия 0.4.0 - Разширена функционалност (Плейлисти, NFO, SponsorBlock)

*   **Поддръжка на плейлисти**: Интеграцията вече може да сваля цели плейлисти, като автоматично обхожда всички видеа в тях.
*   **Генериране на NFO файлове**: Добавена е опция `write_nfo_files` в конфигурацията за автоматично създаване на `.nfo` файлове, съвместими с медийни сървъри като Jellyfin и Kodi.
*   **Интеграция със SponsorBlock**: Добавена е опция `sponsorblock_remove` за автоматично изрязване на спонсорирани сегменти, интро и други.
*   **Предотвратяване на дубликати**: Добавена е опция `prevent_duplicates`, която използва архивен файл, за да не се свалят повторно едни и същи видеа.
*   **Основна преработка на `downloader.py`**: Логиката е изцяло преработена, за да поддържа новите функции.
*   **Разширена конфигурация в `__init__.py`**: Добавени са всички нови опции към конфигурационната схема.
*   **Актуализиран сензор**: Сензорът е обновен, за да показва информация за прогреса при сваляне на плейлисти (напр. `(Video 3 of 15)`).

## Версия 0.3.0 - Корекции на стабилността (Thread Safety)

*   **Корекция в `downloader.py`**: Променен е начинът, по който се изпращат актуализации към сензора. Директното извикване на `async_dispatcher_send` от нишката на `yt-dlp` е заменено с `hass.loop.call_soon_threadsafe`.
*   **Корекция в `__init__.py`**: Променен е начинът, по който се стартира задачата за сваляне. `hass.async_create_task` е заменено с `asyncio.run_coroutine_threadsafe(..., hass.loop)`.
*   **Корекция в `__init__.py`**: Коригирана е грешка `AttributeError: 'HomeAssistant' object has no attribute 'helpers'`.

## Версия 0.2.0 - Сензори, контрол и подобрено логване

*   **Добавен сензор за статус (`sensor.py`)**: Създаден е първоначалният сензор `sensor.yt_dlp_downloader_status`.
*   **Основна преработка на `downloader.py`**: Кодът е рефакториран в клас `Downloader`.
*   **Разширена конфигурация в `__init__.py`**: Добавена е опция `log_level`.
*   **Актуализиран `README.md`**: Включен е първият пример за Lovelace карта.

## Версия 0.1.0 - Първоначално създаване

*   **Създадена е основната структура на проекта** за HACS интеграция.
*   **`__init__.py`**: Дефинирана е основната услуга `yt_dlp_downloader.download`.
*   **`downloader.py`**: Написана е първоначалната логика за сваляне на файлове с `yt-dlp`.
*   **`manifest.json`**, **`services.yaml`**, **`hacs.json`**: Създадени са основните конфигурационни файлове.