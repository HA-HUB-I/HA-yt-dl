# Лог на промените

Този файл документира всички значими промени, направени по интеграцията `yt-dlp-downloader`.

## Версия 0.3.0 - Корекции на стабилността (Thread Safety)

*   **Корекция в `downloader.py`**: Променен е начинът, по който се изпращат актуализации към сензора. Директното извикване на `async_dispatcher_send` от нишката на `yt-dlp` е заменено с `hass.loop.call_soon_threadsafe`. Това решава грешката `Detected code that calls async_dispatcher_send from a thread` и гарантира, че комуникацията с основния цикъл на събитията е безопасна.

*   **Корекция в `__init__.py`**: Променен е начинът, по който се стартира задачата за сваляне. `hass.async_create_task` е заменено с `asyncio.run_coroutine_threadsafe(..., hass.loop)`. Това решава критичната грешка `Detected code that calls hass.async_create_task from a thread`.

*   **Корекция в `__init__.py`**: Коригирана е грешка `AttributeError: 'HomeAssistant' object has no attribute 'helpers'`, като остарелият метод за зареждане на платформа (`hass.helpers.discovery.load_platform`) е заменен с актуалния `discovery.load_platform(hass, ...)`.

## Версия 0.2.0 - Сензори, контрол и подобрено логване

*   **Добавен сензор за статус (`sensor.py`)**: Създаден е нов сензор `sensor.yt_dlp_downloader_status`, който показва текущото състояние на свалянето (`idle`, `Downloading`, `Finished`, `Error`).
    *   Сензорът включва атрибути за **прогрес** (`progress`) в проценти и за текущия **URL** (`url`).

*   **Основна преработка на `downloader.py`**:
    *   Кодът е рефакториран в клас `Downloader`, който управлява състоянието и прогреса на свалянето.
    *   Използва се `progress_hooks` на `yt-dlp` за получаване на данни в реално време.
    *   Добавена е система за известяване (`async_dispatcher_send`), която уведомява сензора при промяна на статуса.

*   **Разширена конфигурация в `__init__.py`**:
    *   Добавена е опция `log_level` в `configuration.yaml`, която позволява детайлно логване (`debug`) на грешки и процеса на сваляне.
    *   Интеграцията вече зарежда автоматично сензорната платформа.

*   **Актуализиран `README.md`**:
    *   Добавени са инструкции за новите функции.
    *   Включен е подробен пример за **Lovelace карта**, която улеснява взаимодействието - поле за URL, бутони за сваляне и визуализация на статуса и прогреса.

## Версия 0.1.0 - Първоначално създаване

*   **Създадена е основната структура на проекта** за HACS интеграция.
*   **`__init__.py`**: Дефинирана е основната услуга `yt_dlp_downloader.download`.
*   **`downloader.py`**: Написана е първоначалната логика за сваляне на файлове с `yt-dlp`.
*   **`manifest.json`**: Добавени са необходимите метаданни за Home Assistant.
*   **`services.yaml`**: Дефинирани са параметрите на услугата (`url`, `format`).
*   **`hacs.json`**: Добавен е конфигурационен файл за HACS.
*   **`README.md`**: Създадени са първоначални инструкции за инсталация и конфигурация.
